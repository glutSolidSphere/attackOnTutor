<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Lobby</title>
		
		<script type="text/javascript" src="/libs/jquery/jquery-3.2.0.min.js"></script>
		<script type="text/javascript" src="/libs/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/libs/socket.io-1.7.3/js/socket.io.min.js"></script>
		<script type="text/javascript" src="/libs/angular-1.6.3/angular.min.js"></script>
		<script type="text/javascript" src="/libs/angular-1.6.3/angular-sanitize.min.js"></script>

		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-module.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-socket-controller.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-student-controller.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-tutor-controller.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-chat-controller.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-activeusers-controller.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-tutor-battle-controller.js"></script>
		<script type="text/javascript" src="/javascripts/Lobby/lobby-angular-student-battle-controller.js"></script>
		
        <link rel="stylesheet" href="/libs/bootstrap-3.3.7-dist/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Kanit:200|Roboto">
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=VT323">
		<link rel="stylesheet" type="text/css" href="/css/lobby.css">
		<link rel="stylesheet" type="text/css" href="/css/navigationbar.css">
		
        <script>
			window.userId = "<%= userId %>";
            window.moduleId = "<%= moduleId %>";
            window.tutorialId = "<%= tutorialId %>";
            window.username = "<%= username %>";
            window.userRole = "<%= userRole %>";
            window.tutorialUuid = "<%= tid %>";
        </script>
		
		<style>
			.rune
			{
				-webkit-transition: all 0.5s ease-out;
				-moz-transition: all 0.5s ease-out;
				-ms-transition: all 0.5s ease-out;
				-o-transition: all 0.5s ease-out;
				transition: all 0.5s ease-out;
				
				-webkit-animation: expand 0.2s ease-out;
				-moz-animation: expand 0.2s ease-out;
				-ms-animation: expand 0.2s ease-out;
				-o-animation: expand 0.2s ease-out;
				animation: expand 0.2s ease-out;
				
				opacity : 1;
				
				transform-origin : center;
			}
			.completed-rune
			{
				opacity : 0;
			}
			
			.rune-symbol
			{
				-webkit-transition: all 0.2s ease-out;
				-moz-transition: all 0.2s ease-out;
				-ms-transition: all 0.2s ease-out;
				-o-transition: all 0.2s ease-out;
				transition: all 0.2s ease-out;
				
				-webkit-animation: expand 0.2s ease-out;
				-moz-animation: expand 0.2s ease-out;
				-ms-animation: expand 0.2s ease-out;
				-o-animation: expand 0.2s ease-out;
				animation: expand 0.2s ease-out;
				
				opacity : 1;
				
				transform-origin : center;
			}
			.completed-symbol
			{
				opacity : 0;
			}
			
			@keyframes expand
			{
				from { transform: scale(0); opacity : 0; }
				to { transform: scale(1); opacity : 1; }
			}
		</style>
    </head>

    <body ng-app="lobbyApp">
	
		<ul id="header"> <!-- Header -->
			<li class="header">
				<a class="active font headerGeneralFontSize" href="/">Index Page</a>
			</li>
		
			<li class="header">
				<a class="active font headerGeneralFontSize" href="/dashboard">Dashboard Page</a>
			</li>
		</ul>
	
		<div ng-controller="socketCtrl" class="container" id="header-bar"> <!-- Title Box -->
			<div class="row">
				<div class="text-center col-md-12 col-sm-12 col-xs-12">
					<h1 class="font whiteFont centerText boldText lobbyBottomFiller">Welcome to <%= moduleId %> <%= tutorialId %>'s Lobby!</h1>
				</div>
			</div>
		</div>
		
		<div ng-controller="studentBattleCtrl">
			<div ng-if="showBattleWindow == true  && socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'student'" id="student-battle-window" class="battle-window"
			style = "
			z-index : 99;
			width : 100%;
			height : 100%;
			top : 0;
			left : 0;
			position : fixed;
			">
				<!-- Background screen -->
				<div
				style = "
				width : 100%;
				height : 100%;
				top : 0;
				left : 0;
				position : fixed;
				background : rgba(0,0,0,.7);
				background-color : rgba(0,0,0,.7);
				opacity : 0.7;
				"
				>
				</div>
				
				<!-- Effects for attacks -->
				<div class="effect"
					ng-repeat="effect in effects"
					ng-style="{'left' : effect.positionLeft + 'px', 'top' : effect.positionTop + 'px',
								'width' : effect.width + 'px', 'height' : effect.height + 'px',
								'margin-left' : effect.marginLeft + 'px', 'margin-top' : effect.height * -0.5 + 'px'}"
					style="
						z-index : 0;
						position : fixed;
						background : url({{effect.image}});
					">
				</div>
				
				<!-- Avatars of students -->
				<div class="student-group"
					ng-repeat="group in groups"
					id="group-{{group.groupName}}"
					ng-style="{'right' : group.positionRight + 'vw', 'bottom' : group.positionBottom + '%'}"
					style="
						position : fixed;
					">
					<div class="student-group-avatar"
						id="student-{{student.userId}}"
						ng-repeat="student in group.members"
						ng-style="{'width' : student.avatarWidth + 'vw', 'height' : student.avatarHeight + 'vw',
								'bottom' : student.displacementBottom + 'vw', 'right' : student.displacementRight + 'vw',
								'margin-right' : student.avatarWidth * -0.5 + 'vw', 'margin-bottom' : student.avatarHeight * -0.5 + 'vw'}"
						style="
							position : absolute;
							z-index : 100;
							background : url({{student.userAvatar}}) no-repeat;
							background-size: cover;
							image-rendering:pixelated;
						">
					</div>
				</div>
				
				<!-- Avatar of player -->
				<div class="player-avatar-group"
					id="player-avatar-group"
					style="
						bottom : 50%;
						right : 0px;
						position : fixed;
					">
					<div class="player-avatar"
						id="player-avatar"
						ng-style="{'width' : studentAvatar.avatarWidth + 'vw', 'height' : studentAvatar.avatarHeight + 'vw',
								'margin-top' : studentAvatar.avatarHeight * -0.5 + 'vw'}"
						style="
							right : 0px;
							top : 0px;
							position : absolute;
							z-index : 100;
							background : url({{studentAvatar.userAvatar}}) no-repeat;
							background-size: cover;
							image-rendering:pixelated;
						">
					</div>
				</div>
				
				<!-- Avatar of tutor -->
				<div class="tutor-avatar-group"
					id="tutor-avatar-group"
					style="
						bottom : 50%;
						position : fixed;
					">
					<div class="tutor-avatar"
						ng-style="{'width' : tutorAvatar.avatarWidth + 'vw', 'height' : tutorAvatar.avatarHeight + 'vw',
								'margin-top' : tutorAvatar.avatarHeight * -0.5 + 'vw'}"
						style="
							position : absolute;
							z-index : 100;
							background : yellow;
						">
					</div>
					
					<div class="tutorial-level-bar centerText lobbyGeneralFontSize"
						style= "
							position: absolute;
							z-index : 100;
							top : {{-tutorAvatar.avatarHeight * 0.4}}px;
							left : {{tutorAvatar.avatarWidth}}px;
							width : 300px;
						">
						Health: {{health}} / {{maxHealth}}
						<br>
						<div class="progress">
							<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{health/maxHealth * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{health/maxHealth * 100}}%">
							{{health/maxHealth * 100}}%
							</div>
						</div>
					</div>
				</div>
				
				<!-- Runes displayed on each group to direct attacks towards specific groups -->
				<div class="rune"
					ng-repeat="rune in runes"
					ng-class="{'completed-rune' : rune.completed, 'incomplete-rune' : !rune.completed}"
					style="
						width : {{rune.width}}px;
						height: {{rune.height}}px;
						bottom: {{rune.positionBottom}}%;						
						right: {{rune.positionRight}}%;
						
						margin-bottom : {{rune.height * -0.5}}px;
						margin-right : {{rune.width * -0.5}}px;
						
						position : fixed;
						background : white;
					">
					<div class="rune-symbol"
						ng-repeat="symbol in rune.symbols"
						ng-class="{'completed-symbol' : symbol.completed, 'incomplete-symbol' : !symbol.completed}"
						ng-style="{'width' : symbol.width + 'px', 'height' : symbol.height + 'px',
								'top' : symbol.positionTop + '%', 'left' : symbol.positionLeft + '%',
								'margin-left' : symbol.width * -0.5 + 'px', 'margin-top' : symbol.height * -0.5 + 'px'}"
						style="
							position : absolute;
							background : red;
							z-index : 100;
						"
						ng-mouseover="markSymbol ($parent.$index, $index)"
						ng-click="markSymbol ($parent.$index, $index)">
					</div>
				</div>
				
				<!-- Battle timer -->
				<div class="timer-container"
					style="
						position : fixed;
						top : 0;
						left : 50%;
						width : 100%;
						height : 3%;
						margin-left : -50%;
					">
					<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="{{currentTime/battleDuration * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{currentTime/battleDuration * 100}}%">
					</div>
				</div>
			
				<!-- Splash screen -->
				<div ng-show="showSplash == true" id="battle-splash-overlay" class="battle-splash-container"
				style ="
				width:100%;
				height:100%;
				top:0;
				left:0;
				position:absolute;
				background-color:rgba(255,0,0,.5);
				"
				>
					<div class="group-ranking-container" id="group-ranking-container"
					ng-repeat="group in rankedGroups"
					style="
					width : 50%;
					height : 50%;
					top : 25%;
					left : 25%;
					position : fixed;
					background-color : white;
					padding:0;
					box-shadow:5px 5px #888888;
					">
						<div class="group-name-header"
						style="
							position:absolute;
							width:100%;
							padding-top:5%;
							bottom:100%;
							left:0px;
							font-size:100%;
							color:white;
							background-color:#888888;
						">
							{{group.groupName}}
						</div>
						<div class="group-rank-header"
						style="
							position:absolute;
							width:30%;
							padding-top:5%;
							bottom:100%;
							left:70%;
							font-size:100%;
							background-color:yellow;
							color:black;
							z-index:1;
						">
							{{group.ranking}}
						</div>
						<div class="group-members-container"
						style="
							position : absolute;
							width : 98%;
							height : 98%;
							top : 1%;
							left : 1%;
							overflow-y : scroll;
						">
							<div class="group-member-icon smoothImage"
							ng-repeat="member in group.members"
							style="
								float:left;
								width : 15%;
								padding-top:15%;
								margin : 5%;
								margin-bottom : 0;
								background : url({{member.userAvatar}}) no-repeat;
								background-size: cover;
								border-radius : 50%;
								border:none;
							">
							</div>
						</div>
					</div>
				</div>
				
				<!-- End Splash screen -->
				<div ng-show="showEndSplash == true" id="battle-splash-overlay" class="battle-splash-container"
				style ="
				width:100%;
				height:100%;
				top:0;
				left:0;
				position:absolute;
				background-color:rgba(0,0,0,.5);
				"
				>
					<div class="loot-container container" id="loot-container"
					style="
						width : 50%;
						height : 50%;
						top : 25%;
						left : 25%;
						position : fixed;
						background-color : white;
						padding:0;
					">
						<div class="loot-header"
						style="
							position:absolute;
							width:98%;
							height:5%;
							top:-6%;
							left:-1%
							font-size:100%;
							color:white;
						">
							LOOT WINDOW
						</div>
						<div class="loot-container"
						style="
							position : absolute;
							width : 98%;
							height : 98%;
							top : 1%;
							left : 1%;
							overflow-y : scroll;
						">
							<div class="loot-icon smoothImage"
							ng-repeat="lootItem in loot"
							style="
								float:left;
								width : 15%;
								padding-top:15%;
								margin : 5%;
								margin-bottom : 0;
								background : url({{lootItem.icon}}) no-repeat;
								background-size: cover;
							">
							</div>
						</div>
						<div class="loot-close-container"
						ng-click="claimLoot()"
						style="
							position:absolute;
							width:20%;
							height:10%;
							bottom:-5%;
							right:40%;
							background:red;
						">
							<div class="loot-close-text"
							style="
								font-size:100%;
								color:white;
								position:relative;
								float:left;
								top:50%;
								left:50%;
								transform:translate(-50%,-50%);
							">
								CLAIM
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div ng-controller="tutorBattleCtrl" >
			<div ng-if="showBattleWindow == true && socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'tutor'" id="tutor-battle-window" class="battle-window"
			style = "
			z-index : 99;
			width : 100%;
			height : 100%;
			top : 0;
			left : 0;
			position : fixed;
			">
				<!-- Background screen -->
				<div
				style = "
				width : 100%;
				height : 100%;
				top : 0;
				left : 0;
				position : fixed;
				background : rgba(0,0,0,.7);
				background-color : rgba(0,0,0,.7);
				opacity : 0.7;
				"
				>
				</div>
				
				<!-- Effects for attacks -->
				<div class="effect"
					ng-repeat="effect in effects"
					ng-style="{'left' : effect.positionLeft + 'px', 'top' : effect.positionTop + 'px',
								'width' : effect.width + 'px', 'height' : effect.height + 'px',
								'margin-left' : effect.marginLeft + 'px', 'margin-top' : effect.marginTop + 'px'}"
					style="
						position : fixed;
						background : url({{effect.image}});
					">
				</div>
				
				<!-- Avatars of students -->
				<div class="student-group"
					ng-repeat="group in groups"
					id="group-{{group.groupName}}"
					ng-style="{'right' : group.positionRight + 'vw', 'bottom' : group.positionBottom + '%'}"
					style="
						position : fixed;
					">
					<div class="student-group-avatar"
						id="student-{{student.userId}}"
						ng-repeat="student in group.members"
						ng-style="{'width' : student.avatarWidth + 'vw', 'height' : student.avatarHeight + 'vw',
								'bottom' : student.displacementBottom + 'vw', 'right' : student.displacementRight + 'vw',
								'margin-right' : student.avatarWidth * -0.5 + 'vw', 'margin-bottom' : student.avatarHeight * -0.5 + 'vw'}"
						style="
							position : absolute;
							z-index : 100;
							background : url({{student.userAvatar}}) no-repeat;
							background-size: cover;
							image-rendering:pixelated;
						">
					</div>
				</div>
				
				<!-- Avatar of tutor -->
				<div class="tutor-avatar-group"
					id="tutor-avatar-group"
					style="
						bottom : 50%;
						position : fixed;
					">
					<div class="tutor-avatar"
						ng-style="{'width' : tutorAvatar.avatarWidth + 'vw', 'height' : tutorAvatar.avatarHeight + 'vw',
								'margin-top' : tutorAvatar.avatarHeight * -0.5 + 'vw'}"
						style="
							position : absolute;
							z-index : 100;
							background : yellow;
						">
					</div>
					
					<div class="tutorial-level-bar centerText lobbyGeneralFontSize"
						style= "
							position: absolute;
							z-index : 100;
							top : {{-tutorAvatar.avatarHeight * 0.4}}px;
							left : {{tutorAvatar.avatarWidth}}px;
							width : 300px;
						">
						Health: {{health}} / {{maxHealth}}
						<br>
						<div class="progress">
							<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{health/maxHealth * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{health/maxHealth * 100}}%">
							{{health/maxHealth * 100}}%
							</div>
						</div>
					</div>
				</div>
				
				<!-- Effects for attack damage
				<div class="effect"
					ng-repeat="effect in effects"
					ng-style="{'left' : effect.positionLeft + 'px', 'top' : effect.positionTop + 'px',
								'width' : effect.width + 'px', 'height' : effect.height + 'px',
								'margin-left' : effect.marginLeft + 'px', 'margin-top' : effect.height * -0.5 + 'px'}"
					style="
						position : fixed;
						background : url({{effect.image}});
					">
				</div> -->
				
				<!-- Runes displayed on each group to direct attacks towards specific groups -->
				<div class="rune"
					ng-repeat="rune in runes"
					ng-class="{'completed-rune' : rune.completed, 'incomplete-rune' : !rune.completed}"
					style="
						width : {{rune.width}}px;
						height: {{rune.height}}px;
						bottom: {{rune.positionBottom}}%;						
						right: {{rune.positionRight}}%;
						
						margin-bottom : {{rune.height * -0.5}}px;
						margin-right : {{rune.width * -0.5}}px;
						
						position : fixed;
						background : white;
					">
					<div class="rune-symbol"
						ng-repeat="symbol in rune.symbols"
						ng-class="{'completed-symbol' : symbol.completed, 'incomplete-symbol' : !symbol.completed}"
						ng-style="{'width' : symbol.width + 'px', 'height' : symbol.height + 'px',
								'top' : symbol.positionTop + '%', 'left' : symbol.positionLeft + '%',
								'margin-left' : symbol.width * -0.5 + 'px', 'margin-top' : symbol.height * -0.5 + 'px'}"
						style="
							position : absolute;
							background : red;
							z-index : 100;
						"
						ng-mouseover="markSymbol ($parent.$index, $index)"
						ng-click="markSymbol ($parent.$index, $index)">
					</div>
				</div>
				
				<div class="timer-container"
					style="
						position : fixed;
						top : 0;
						left : 50%;
						width : 100%;
						height : 3%;
						margin-left : -50%;
					">
					<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="{{currentTime/battleDuration * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{currentTime/battleDuration * 100}}%">
					</div>
				</div>
			
				<!-- Splash screen -->
				<div ng-show="showSplash == true" id="battle-splash-overlay" class="battle-splash-container"
				style ="
				width:100%;
				height:100%;
				top:0;
				left:0;
				position:absolute;
				background-color:rgba(255,0,0,.5);
				"
				>
					<div class="group-ranking-container" id="group-ranking-container"
					ng-repeat="group in rankedGroups"
					style="
					width : 50%;
					height : 50%;
					top : 25%;
					left : 25%;
					position : fixed;
					background-color : white;
					padding:0;
					box-shadow:5px 5px #888888;
					">
						<div class="group-name-header"
						style="
							position:absolute;
							width:100%;
							padding-top:5%;
							bottom:100%;
							left:0px;
							font-size:100%;
							color:white;
							background-color:#888888;
						">
							{{group.groupName}}
						</div>
						<div class="group-rank-header"
						style="
							position:absolute;
							width:30%;
							padding-top:5%;
							bottom:100%;
							left:70%;
							font-size:100%;
							background-color:yellow;
							color:black;
							z-index:1;
						">
							{{group.ranking}}
						</div>
						<div class="group-members-container"
						style="
							position : absolute;
							width : 98%;
							height : 98%;
							top : 1%;
							left : 1%;
							overflow-y : scroll;
						">
							<div class="group-member-icon smoothImage"
							ng-repeat="member in group.members"
							style="
								float:left;
								width : 15%;
								padding-top:15%;
								margin : 5%;
								margin-bottom : 0;
								background : url({{member.userAvatar}}) no-repeat;
								background-size: cover;
								border-radius : 50%;
								border:none;
							">
							</div>
						</div>
					</div>
				</div>
				
				<!-- End Splash screen -->
				<div ng-show="showEndSplash == true" id="battle-splash-overlay" class="battle-splash-container"
				style ="
				width:100%;
				height:100%;
				top:0;
				left:0;
				position:absolute;
				background-color:rgba(0,255,0,.5);
				"
				>
				</div>
			
			</div>
		</div>
		
		<div class="container-fluid">
			<div class="row" id="battle-container">
				<div ng-controller="tutorCtrl">
					
					<div class="col-md-3 col-md-offset-1 col-sm-3 col-xs-5 affix" ng-if="socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'tutor'">
						<div class="text-center row smoothImage border-normal">
							<div class="font whiteFont level-container">
								<div class="row"> <!-- Tutor Details -->
	                    			<div class="col-md-4 col-sm-6 col-xs-6">
										<img ng-src="{{userInfo.imgSrc}}" class="img-responsive smoothImage fullImage"/>
									</div>

									<div class="col-md-8 col-sm-6 col-xs-6">
				                   		<h2 class="brownFont centerText boldText"><%= username %></h2>
				                    </div>
				                </div>

								<div class="tutorial-level-bar centerText lobbyGeneralFontSize">
			                        Health: {{health}} / {{maxHealth}}
			                        <br>
			                        <div class="progress">
										<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{health/maxHealth * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{health/maxHealth * 100}}%">
										{{health/maxHealth * 100}}%
										</div>
			                        </div>
			                    </div>
								
								<div id="battle-mode-options-container" class="centerText lobbyGeneralFontSize">
			                        <div class="battle-mode-toggle-div">
										<button class="btn" ng-click="startBattle()">Start Battle</button>
			                        </div>
			                    </div>
			                </div>
						</div>
						<div class="row smoothImage border-normal">
							<div ng-controller="activeUsersCtrl">
								<div class="col-md-12 col-sm-12 col-xs-12" id="userlist-container" ng-if="socket.getConnectionState() == socket.CONNECTED()">
									<div class="text-center row">
										<h2 class="font whiteFont centerText boldText lobbyBottomFiller"> Active Users </h2>
									</div>
									
									<!-- List of Groups -->
									<div class="row">
										<div class="groups-list">
			                                <div class="container-fluid">
			                                    <div class="row outer-container font">
			                                        <button class="btn select-group" ng-class="{'btn-success' : selectedGroup == $index, 'btn-info' : selectedGroup != $index}" ng-repeat="group in socket.getAllSocketGroups()" ng-click="setSelectedGroup($index)">{{group}}</button>
			                                    </div>
			                                </div>
										</div>
									</div>
									
									<!-- List and Toggle Tutees in Groups -->
									<div class="row outer-container" ng-if="socket.getUserType() =='tutor'">
										<div class="users-active-list">
											<div class="users-active">
												<div class="user-active border-gold-trimmed maximumWidth" ng-repeat="user in users[socket.getAllSocketGroups()[selectedGroup]]">
				                                    <div class="container-fluid">
				                                        <div class="row-fluid font lobbyGeneralFontSize" ng-click="selectUser(user.socketId);" ng-style="{'color' : selectedUsers.indexOf (user.socketId) < 0 ? 'white' : 'yellow'}">
				                                            {{user.username}}
				                                        </div>
				                                    </div>
				                                </div>
											</div>
										</div>
									</div>
									
									<div class="row outer-container" ng-if="socket.getUserType() == 'student'">
										<div class="users-active-list">
											<div class="users-active">
												<div class="user-active border-gold-trimmed maximumWidth" ng-repeat="user in users[socket.getAllSocketGroups()[selectedGroup]]">
				                                    <div class="container-fluid">
				                                        <div class="row-fluid font lobbyGeneralFontSize" ng-click="selectUser(user.socketId);" ng-style="{'color' : selectedUsers.indexOf (user.socketId) < 0 ? 'white' : 'yellow'}">
				                                            {{user.username}}
				                                        </div>
				                                    </div>
				                                </div>
											</div>
										</div>
									</div>
									
									<!-- Tutors will be able to Create and Delete Groups -->
									<div class="row-fluid" ng-if="socket.getUserType() == 'tutor'">
										<div class="row">
			                            	<input class="input-group-name font maximumWidth lobbyGeneralFontSize" ng-model="$parent.$parent.newGroupName" placeholder="Type Your Group Name Here!"/>
			                        	</div>

			                        	<div class="row">
			                            	<button class="btn create-group font" ng-click="createGroup()" ng-disabled="!isValidGroupParams()">Create Group!</button>
			                            	<div ng-if="selectedGroup > 0">
			                            		<button class="btn delete-group font" ng-click="deleteGroup()">Delete Group</button>
			                            	</div>
			                        	</div>
			                        </div>
								
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-7 col-md-offset-4 col-sm-9 col-sm-offset-3 col-xs-7 col-xs-offset-5 smoothImage border-normal" id="question-list-container" ng-if="socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'tutor'">
						<div class="text-center row"> <!-- Question Composer -->
							<h2 class="font whiteFont centerText boldText lobbyBottomFiller">Question Composer</h2>
						</div>

						<div class="row">
							<div class="question-area">
								<textarea class="question-description-input font maximumWidth lobbyGeneralFontSize" ng-model="composerQuestion.description" placeholder="Type Your Question Here!" type="text"  ng-trim="false"></textarea>
							</div>
						</div>
						
						<div class="row">
							<div class="groups-list">
                                <div>
									<!-- List of Groups to Send the Question to -->
									<h3 class="font whiteFont boldText">Groups To Send To:</h3>
                                    <div class="row-fluid">
										<button class="btn select-group font" ng-class="{'btn-info' : inSelectedGroups($index), 'btn-success' : !inSelectedGroups($index)}" ng-repeat="group in socket.getSocketGroups()" ng-if="$index > 0" ng-click="toggleSelectedGroup($index)">{{group}}</button>

                                        <button class="btn send-question floatRight font" ng-disabled="composerQuestion.description.length == 0 || selectedGroups.length == 0" ng-click="sendQuestion()">Send Question</button>
                                    </div>
                                </div>
							</div>
						</div>
						
						<div class="row">
							<!-- Tutor Waiting for Answers -->
							<div class="answers-received-area">
								<div class="answers-received-list">
	                                <div class="answers-received" ng-repeat="(uuid, question) in questions">
	                                    <div class="col-md-12 col-sm-12 col-xs-12 border-gold-trimmed marginTop">
	                                        <div class="row">
	                                            <h3 class="font whiteFont boldText marginBottom chatWhiteSpace" ng-bind-html="question.description"></h3>
	                                        </div>
	                    
											<div class="row">
		                                    	<button class="btn answers-received-select-group font" ng-class="{'btn-info' : question.selectedGroup == question.groupNames[$index], 'btn-success' : question.selectedGroup != question.groupNames[$index]}" ng-repeat="group in question.groupNames" ng-click="setSelectedGroup(uuid, $index)">{{group}}</button>
	                                        </div>
	                                        
											<div class="row group-received-answers" ng-show="question.groupAnswers[question.selectedGroup].answered">
	                                            <div class="container-fluid border-gold-trimmed">
	                                            	<div class="col-md-4 col-sm-4 col-xs-4 font whiteFont lobbyGeneralFontSize">
	                                            		<div>	{{question.groupAnswers[question.selectedGroup].student}}
                                                   		</div>
	                                                </div>
	                                                
													<div class="col-md-8 col-sm-8 col-xs-8 font whiteFont lobbyGeneralFontSize">
                                                   		<div class="answer-description chatWhiteSpace" ng-bind-html="question.groupAnswers[question.selectedGroup].description"></div>
	                                                </div>
	                                            </div>
	                                            
												<!-- Justify Damage for Answer -->
												<div class="container-fluid">
													<div class="explanation-area font maximumWidth">
														<textarea class="answer-explanation-input maximumWidth lobbyGeneralFontSize" ng-model="question.groupAnswers[question.selectedGroup].explanation"
															placeholder="Explanation!" type="text"  ng-trim="false" ng-disabled="question.graded">
														</textarea>
													</div>
												</div>
												
												<div class="container-fluid">
		                                        	<input class="experience-input font maximumWidth lobbyGeneralFontSize" type="number" ng-model="question.groupAnswers[question.selectedGroup].experience" ng-disabled="question.graded"/>
														<button class="btn grade-question floatRight font" ng-if="isQuestionAnswered(uuid)" ng-disabled="question.graded" ng-click="gradeQuestion(uuid)">Announce</button>	
		                                        </div>
	                                        </div>
	                                        
											<div class="row" ng-show="!question.groupAnswers[question.selectedGroup].answered">
                                                <div class="font whiteFont lobbyGeneralFontSize">
                                               		Status: Waiting for Answer...
                                                </div>
                                            </div>
	                                    </div>
	                                </div>
	                            </div>
							</div>
						</div>
					</div>
				</div>
                
                <div ng-controller="studentCtrl"> <!-- Tutee View -->
					<div class="col-md-3 col-sm-3 col-xs-3 affix" ng-if="socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'student'">
						<div class="text-center row smoothImage border-normal">
							<div class="font whiteFont level-container">
                    			
                    			<div class="row">
	                    			<div class="col-md-4 col-sm-6 col-xs-6">
										<img ng-src="{{tutorInfo.imgSrc}}" class="img-responsive smoothImage fullImage"/>
									</div>

									<div class="col-md-8 col-sm-6 col-xs-6">
				                   		<h2 class="brownFont centerText boldText">{{tutorInfo.username}}</h2>
				                    </div>
				                </div>
			                    
								<div class="tutorial-level-bar centerText lobbyGeneralFontSize">
			                        Health: {{health}} / {{maxHealth}}
			                        <br>
			                        <div class="progress">
										<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{health/maxHealth * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{health/maxHealth * 100}}%">
										{{health/maxHealth * 100}}%
										</div>
			                        </div>
			                    </div>
			                </div>
						</div>
						<div class="row smoothImage border-normal">
							<div ng-controller="activeUsersCtrl">
								<div class="col-md-12 col-sm-12 col-xs-12" id="userlist-container" ng-if="socket.getConnectionState() == socket.CONNECTED()">
									<div class="text-center row">
										<h2 class="font whiteFont centerText boldText lobbyBottomFiller"> Active Users </h2>
									</div>
									
									<div class="row">
										<div class="groups-list">
			                                <div class="container-fluid">
			                                    <div class="row outer-container font">
			                                        <button class="btn select-group" ng-class="{'btn-info' : selectedGroup == $index, 'btn-success' : selectedGroup != $index}" ng-repeat="group in socket.getAllSocketGroups()" ng-click="setSelectedGroup($index)">{{group}}</button>
			                                    </div>
			                                </div>
										</div>
									</div>
									
									<div class="row outer-container" ng-if="socket.getUserType() =='tutor'">
										<div class="users-active-list">
											<div class="users-active">
												<div class="user-active border-gold-trimmed maximumWidth" ng-repeat="user in users[socket.getAllSocketGroups()[selectedGroup]]">
				                                    <div class="container-fluid">
				                                        <div class="row-fluid font lobbyGeneralFontSize" ng-click="selectUser(user.socketId);" ng-style="{'color' : selectedUsers.indexOf (user.socketId) < 0 ? 'white' : 'yellow'}">
				                                            {{user.username}}
				                                        </div>
				                                    </div>
				                                </div>
											</div>
										</div>
									</div>
									
									<div class="row outer-container" ng-if="socket.getUserType() == 'student'">
										<div class="users-active-list">
											<div class="users-active">
												<div class="user-active border-gold-trimmed maximumWidth" ng-repeat="user in users[socket.getAllSocketGroups()[selectedGroup]]">
				                                    <div class="container-fluid">
				                                        <div class="row-fluid font lobbyGeneralFontSize" ng-click="selectUser(user.socketId);" ng-style="{'color' : selectedUsers.indexOf (user.socketId) < 0 ? 'white' : 'yellow'}">
				                                            {{user.username}}
				                                        </div>
				                                    </div>
				                                </div>
											</div>
										</div>
									</div>
									
									<div class="row-fluid" ng-if="socket.getUserType() == 'tutor'">
										<div class="row">
			                            	<input class="input-group-name font maximumWidth lobbyGeneralFontSize" ng-model="$parent.$parent.newGroupName" placeholder="Type Your Group Name Here!"/>
			                        	</div>

			                        	<div class="row">
			                            	<button class="btn create-group font" ng-click="createGroup()" ng-disabled="!isValidGroupParams()">Create Group!</button>
			                            	<div ng-if="selectedGroup > 0">
			                            		<button class="btn delete-group font" ng-click="deleteGroup()">Delete Group</button>
			                            	</div>
			                        	</div>
			                        </div>
								
								</div>
							</div>
						</div>
					</div>
				
                	<div class="col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3 col-xs-6 col-xs-offset-3 smoothImage border-normal" ng-if="socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'student'">
						<div class="text-center row">
							<h2 class="font whiteFont centerText boldText"> Combat Log </h2>
						</div>
						
						<!-- Tutee Receive Questions -->
						<div class="row">
							<div class="questions-received-area outer-container maximumWidth overflow">
								<div class="questions-received-list">
	                                <div class="question-received border-gold-trimmed outer-container" ng-repeat="(uuid, question) in questions">
	                                    <div class="col-md-12 col-sm-12 col-xs-12">
	                                        <div class="row">
	                                            <h3 class="font whiteFont boldText chatWhiteSpace" ng-bind-html="question.description"></h3>
	                                        </div>
	                                        
											<div class="question-received-answers">
	                                            <div ng-repeat="answer in question.answers" class="row border-gold-trimmed">
	                                            	<div class="row">
		                                            	<div class="col-md-4 col-sm-4 col-xs-4 font whiteFont lobbyGeneralFontSize">
	                                                   		{{answer.student.username}}
		                                                </div>
		                                                
														<div class="col-md-8 col-sm-8 col-xs-8">
	                                                   		<textarea class="answer-description-input font maximumWidth lobbyGeneralFontSize" ng-show="answer.owned" ng-model="answer.description" placeholder="Type answer..." type="text"  ng-trim="false" ng-disabled="question.submitted"></textarea>
	                                                   		<div class="answer-description chatWhiteSpace font whiteFont" ng-show="!answer.owned" ng-bind-html="answer.description"></div>
		                                                </div>
	                                                </div>
													
	                                                <div class="row-fluid">
														<button class="btn vote-answer font floatLeft" ng-class="{'btn-success' : answer.selected, 'btn-warning' : !answer.selected }" ng-click="selectAnswer(uuid, $index)"  ng-disabled="question.submitted">Vote: {{answer.selectedCount}} </button>

			                                        </div>
	                                            </div>
	                                        </div>
	                                    </div>
	                                    
										<div class="container-fluid" ng-show="question.graded">
	                                    	<div class="row-fluid"">
		                                    	<button class="row btn answers-received-select-group font marginTop" ng-class="{'btn-info' : question.selectedGroup == question.groupNames[$index], 'btn-success' : question.selectedGroup != question.groupNames[$index]}" ng-repeat="group in question.groupNames" ng-click="setSelectedGroup(uuid, $index)">{{group}}</button>
	                                        </div>
	                                       
											<div class="row-fluid group-received-answers">
	                                            <div class="row border-gold-trimmed">
	                                            	<div class="col-md-3 col-sm-3 col-xs-3 font whiteFont lobbyGeneralFontSize">
	                                            		<div>	{{question.groupAnswers[question.selectedGroup].student}}
                                                   		</div>
	                                                </div>
	                                                
													<div class="col-md-9 col-sm-9 col-xs-9 font whiteFont lobbyGeneralFontSize">
                                                   		<div class="answer-description font whiteFont chatWhiteSpace" ng-bind-html="question.groupAnswers[question.selectedGroup].description"></div>
	                                                </div>
	                                            </div>
	                                            
												<div class="row border-gold-trimmed">
													<div class="col-md-3 col-sm-3 col-xs-3 whiteFont">
														<div class="experience-input font whiteFont lobbyGeneralFontSize floatLeft"
															ng-bind-html="question.groupAnswers[question.selectedGroup].experience">
														</div>
													</div>
													
													<div class="col-md-9 col-sm-9 col-xs-9 font whiteFont lobbyGeneralFontSize">
														<div class="answer-explanation-input whiteFont maximumWidth"
															ng-bind-html="question.groupAnswers[question.selectedGroup].explanation">
														</div>
													</div>
												</div>
	                                        </div>
	                                    </div>

										<div class="container-fluid" ng-show="!question.graded">
	                                    	<div class="row font whiteFont lobbyGeneralFontSize">
		                                    	Status: Waiting for Grading...
											</div>
	                                    </div>

	                                    <div class="container-fluid" ng-show="!question.graded">
	                                    	<div class="row font whiteFont">
	                                    		<button class="btn update-answer font floatLeft" ng-disabled="question.submitted" ng-click="updateAnswer(uuid)">Update</button>
												<button class="btn submit-answer floatRight font" ng-if="hasAllVotes(uuid) && !question.submitted" ng-click="submitAnswer(uuid)">Attack</button>
	                                    	</div>
	                                    </div>
	                                </div>
	                            </div>
							</div>
						</div>
					</div>
					
					<div class="col-md-3 col-md-offset-9 col-sm-3 col-sm-offset-9 col-xs-3 col-xs-offset-9 affix" ng-if="socket.getConnectionState() == socket.CONNECTED() && socket.getUserType() == 'student'">
						<div class="text-center row smoothImage border-normal">
							<div class="font whiteFont level-container">
                    			
                    			<div class="row">
	                    			<div class="col-md-4 col-sm-6 col-xs-6">
										<img ng-src="{{userInfo.imgSrc}}" class="img-responsive smoothImage fullImage"/>
									</div>

									<div class="col-md-8 col-sm-6 col-xs-6">
				                   		<h2 class="brownFont centerText boldText"><%= username %></h2>
				                    </div>
				                </div>
			                    
								<div class="tutorial-level-bar centerText lobbyGeneralFontSize">
									Level: <span ng-bind-html="userInfo.level"></span>
									<br>
			                        Experience: {{userInfo.exp}} / {{userInfo.expToNext}}
			                        <br>
			                        <div class="progress">
										<div class="progress-bar" role="progressbar" aria-valuenow="{{userInfo.exp / userInfo.expToNext * 100}}" aria-valuemin="0" aria-valuemax="100" style="width: {{userInfo.exp / userInfo.expToNext * 100}}%">
										{{userInfo.exp / userInfo.expToNext * 100}}%
										</div>
			                        </div>
			                    </div>
			                </div>
						</div>
					</div>
				</div>	
			</div>

			<div class="row" id="lobby-container">

				<!-- Message Area -->
				<div ng-controller="chatCtrl">
					<div class="smoothImage border-normal" id="chat-container" ng-if="socket.getConnectionState() == socket.CONNECTED()" ng-class="{ 'col-md-7 col-md-offset-4 col-sm-9 col-sm-offset-3 col-xs-7 col-xs-offset-5' : socket.getUserType() == 'tutor', 'col-md-6 col-md-offset-3 col-sm-6 col-sm-offset-3 col-xs-6 col-xs-offset-3' : socket.getUserType() == 'student'}">
						
						<div class="text-center row">
							<h2 class="font whiteFont centerText boldText lobbyBottomFiller"> Messages </h2>
						</div>
						
						<div class="row">
							<div class="groups-list">
                                <div class="container-fluid">
                                    <div class="row outer-container font">
                                        <button class="btn select-group" ng-class="{'btn-info' : selectedGroup == $index, 'btn-success' : selectedGroup != $index}" ng-repeat="group in socket.getSocketGroups()" ng-click="setSelectedGroup($index)">{{group}}</button>
                                    </div>
                                </div>
							</div>
						</div>
						
						<div class="row outer-container">
							<div class="chat-area border-gold-trimmed" id="messageBox">
								<div class="messages">
									<div ng-repeat="message in messages[socket.getSocketGroups()[selectedGroup]]"
										ng-class="{'log' : message.type=='log', 'message' : message.type=='message'}"
										data-username="{{message.user}}">
										<div ng-if="message.type == 'chat'">
											<span class="username font lobbyGeneralFontSize" ng-bind="message.user" style="color:{{getUsernameColor(message.user)}};"></span> 
											<span class="messageBody font whiteFont lobbyGeneralFontSize" ng-bind="message.message"></span>
										</div>
										
										<div class="font whiteFont lobbyGeneralFontSize" ng-class="{ 'log' : message.type == 'log'}" ng-if="message.type == 'log'">
											{{ message.message }}
										</div>

										<div class="font whiteFont lobbyGeneralFontSize" ng-class="{ 'damagelog' : message.type == 'damagelog'}" ng-if="message.type == 'damagelog'">
											{{ message.message }}
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<div class="row">
							<div class="typing-message-area maximumWidth">
								<div class="typing-messages">
									<div ng-repeat="typingMessage in typingMessages">
										<div>
											<span class="username font whiteFont lobbyGeneralFontSize" ng-bind="typingMessage.user" style="color:{{getUsernameColor(typingMessage.user)}};"></span>
											<span class="messageBody font whiteFont lobbyGeneralFontSize" ng-bind="typingMessage.message"></span>
										</div>
									</div>
								</div>
							</div>
						</div>
						
						<div class="row">
							<!-- ng-model within ng-if block must reference the data prepended by $parent -->
							<input class="inputMessage font maximumWidth lobbyGeneralFontSize" ng-model="$parent.chatMessage" ng-enter="sendMessage()" ng-change="updateTyping()" placeholder="Type Your Message Here!"/>
						</div>
					
					</div>
				</div>
			</div>
			
			
		</div>			

	</body>
</html>

<script src="js/lobby.js" type="application/javascript"></script>